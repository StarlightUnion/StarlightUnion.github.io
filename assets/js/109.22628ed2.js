(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{808:function(s,t,a){"use strict";a.r(t);var e=a(39),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx部署react项目至服务器二级目录实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx部署react项目至服务器二级目录实践"}},[s._v("#")]),s._v(" Nginx部署React项目至服务器二级目录实践")]),s._v(" "),t("ClientOnly",[t("display-bar",{attrs:{displayData:s.$frontmatter}})],1),s._v(" "),t("blockquote",[t("p",[s._v("本文记录了一次"),t("code",[s._v("React")]),s._v("项目使用"),t("code",[s._v("Nginx")]),s._v("部署至服务器二级目录的实践过程。")])]),s._v(" "),t("h2",{attrs:{id:"一、修改资源路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、修改资源路径"}},[s._v("#")]),s._v(" 一、修改资源路径")]),s._v(" "),t("p",[t("code",[s._v("React")]),s._v("打包后的资源路径是"),t("code",[s._v("/static/xxx.js")]),s._v("这种形式，是从项目根路径（即"),t("code",[s._v("nginx")]),s._v("中的"),t("code",[s._v("root")]),s._v("设置的路径）开始的，如果要部署到二级目录，需要将其修改为"),t("code",[s._v("./")]),s._v("。")]),s._v(" "),t("p",[s._v("当然如果部署环境需要也可以改为"),t("code",[s._v("../")]),s._v("或其它。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/other/aboutdeploy/sub-directory-deploy-01.png",alt:"sub-directory-deploy-01"}})]),s._v(" "),t("p",[s._v("如上图所示👆 ，在"),t("code",[s._v("package.json")]),s._v("中添加"),t("code",[s._v('"homepage": "."')]),s._v("，即可将资源的路径修改为"),t("code",[s._v("./static/xxx.js")]),s._v("这种形式。")]),s._v(" "),t("h2",{attrs:{id:"二、在路由中添加basename"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、在路由中添加basename"}},[s._v("#")]),s._v(" 二、在路由中添加"),t("code",[s._v("basename")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/other/aboutdeploy/sub-directory-deploy-02.png",alt:"sub-directory-deploy-02"}})]),s._v(" "),t("p",[s._v("还是如上图所示👆 ，添加"),t("code",[s._v('basename="/example"')]),s._v("，")]),s._v(" "),t("p",[s._v("此时，如果你的页面原来是"),t("code",[s._v("localhost:8000/home")]),s._v("，添加之后将会变为"),t("code",[s._v("localhost:8000/example/home")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"三、将项目打包之后部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、将项目打包之后部署"}},[s._v("#")]),s._v(" 三、将项目打包之后部署")]),s._v(" "),t("p",[s._v("项目打包之后部署至"),t("code",[s._v("Nginx")]),s._v("中配置的"),t("code",[s._v("root")]),s._v("目录下的二级目录"),t("code",[s._v("example")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_1-简单配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-简单配置"}},[s._v("#")]),s._v(" 1.简单配置")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  192.168.0.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   root_dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/example/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("由于"),t("strong",[s._v("路由的存在")]),s._v("，简单配置并不可行。")]),s._v(" "),t("p",[s._v("这种配置在路由跳转时会因为直接"),t("strong",[s._v("404")]),s._v("。比如从"),t("code",[s._v("/example/")]),s._v("跳转到"),t("code",[s._v("/example/home")]),s._v("因为"),t("code",[s._v("example")]),s._v("目录下并无"),t("code",[s._v("home")]),s._v("目录而找不到资源。")]),s._v(" "),t("h3",{attrs:{id:"_2-对资源请求做特殊处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-对资源请求做特殊处理"}},[s._v("#")]),s._v(" 2.对资源请求做特殊处理")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  192.168.0.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   root_dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# autoindex on;")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# autoindex_exact_size off;")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# autoindex_localtime on;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/example/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /example/index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~*  ^/([^/]+\\.js)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /nginx-1.14.2/root_dir/example/js/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* ^/\\.(js)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" root_dir/example/js/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~*  ^/([^/]+\\.css)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /nginx-1.14.2/root_dir/example/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* ^/\\.(css)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" root_dir/example/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h3",{attrs:{id:"要点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#要点"}},[s._v("#")]),s._v(" 要点")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("try_files $uri $uri/ /example/index.html;")]),s._v("：设置一个查找顺序。")]),s._v(" "),t("p",[s._v("比如寻找"),t("code",[s._v("xxx.js")]),s._v("，"),t("strong",[s._v("寻找顺序为")]),s._v("：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("$uri")]),s._v("=>"),t("code",[s._v("/root_dir/example/xxx.js")]),s._v(";")]),s._v(" "),t("li",[t("code",[s._v("$uri/")]),s._v("=>"),t("code",[s._v("/root_dir/example/xxx.js/index")]),s._v(";")]),s._v(" "),t("li",[t("code",[s._v("/root_dir/example/index.html")]),s._v("。")])])]),s._v(" "),t("li",[t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~*  ^/([^/]+\\.js)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /nginx-1.14.2/root_dir/example/js/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* ^/\\.(js)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" root_dir/example/js/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("这一组是"),t("strong",[s._v("重定向")]),s._v("资源路径，另一组也是一样的。它将"),t("code",[s._v(".js")]),s._v("的请求地址重定向到了"),t("code",[s._v("alias")]),s._v("和"),t("code",[s._v("root")]),s._v("指定的地址。")]),s._v(" "),t("p",[t("code",[s._v("alias")]),s._v("和"),t("code",[s._v("root")]),s._v("的区别可以了解一下。")])])]),s._v(" "),t("h2",{attrs:{id:"四、参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、参考资料"}},[s._v("#")]),s._v(" 四、参考资料")]),s._v(" "),t("ul",[t("li",[s._v("1."),t("a",{attrs:{href:"https://blog.csdn.net/qq_35856855/article/details/88174523?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.channel_param",target:"_blank",rel:"noopener noreferrer"}},[s._v("关于react 在打包后：“找不到资源路径”的问题、部署到服务器二级目录"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("2."),t("a",{attrs:{href:"https://blog.csdn.net/qq_24861509/article/details/102716191",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx配置选项try_files详解"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("3."),t("a",{attrs:{href:"https://www.nginx.cn/4658.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx的location、root、alias指令用法和区别"),t("OutboundLink")],1)])])],1)}),[],!1,null,null,null);t.default=n.exports}}]);