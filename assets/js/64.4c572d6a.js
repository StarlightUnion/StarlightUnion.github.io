(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{763:function(s,t,e){"use strict";e.r(t);var a=e(39),r=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"resizeobserver监听元素的resize事件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#resizeobserver监听元素的resize事件"}},[s._v("#")]),s._v(" ResizeObserver监听元素的resize事件")]),s._v(" "),t("ClientOnly",[t("display-bar",{attrs:{displayData:s.$frontmatter}})],1),s._v(" "),t("blockquote",[t("p",[s._v("最近在写业务中有遇到需要监听"),t("strong",[s._v("一个元素")]),s._v("的"),t("code",[s._v("resize")]),s._v("事件的需求（为了实现"),t("strong",[s._v("自适应布局")]),s._v("）。")]),s._v(" "),t("p",[s._v("虽然存在"),t("code",[s._v("window.onresize")]),s._v("这个API，但是它却是用来监听"),t("strong",[s._v("浏览器窗口")]),s._v("的"),t("code",[s._v("resize")]),s._v("事件，那我在业务中总不能让用户去"),t("strong",[s._v("拖拽浏览器窗口吧")]),s._v("，这听着就不是一个好主意。")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("几经查找（"),t("s",[s._v("百度")]),s._v("），发现了"),t("code",[s._v("ResizeObserver")]),s._v("，虽然"),t("strong",[s._v("该API目前还处在实验中")]),s._v("，但是浏览器兼容性非常不错：👇")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/frontend/js/resize-observer-01.png",alt:"resize-observer-01"}})]),s._v(" "),t("p",[t("strong",[s._v("有鉴于我司产品只应用于PC端浏览器，不用考虑兼容移动端，而且貌似也没有其它的解决办法，所以姑且用它把。。")])])]),s._v(" "),t("p",[t("code",[s._v("ResizeObserver")]),s._v("的API：👇")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("方法")]),s._v(" "),t("th",[s._v("介绍")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("ResizeObserver.disconnct()")])]),s._v(" "),t("td",[s._v("取消和结束目标对象上所有对"),t("code",[s._v("Element")]),s._v("或"),t("code",[s._v("SVGElement")]),s._v("观察。")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("ResizeObserver.observe()")])]),s._v(" "),t("td",[s._v("开始观察指定的"),t("code",[s._v("Element")]),s._v("或"),t("code",[s._v("SVGElement")]),s._v("。")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("ResizeObserver.unobserve()")])]),s._v(" "),t("td",[s._v("结束观察指定的"),t("code",[s._v("Element")]),s._v("或"),t("code",[s._v("SVGElement")]),s._v("。")])])])]),s._v(" "),t("h2",{attrs:{id:"一、使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、使用"}},[s._v("#")]),s._v(" 一、使用")]),s._v(" "),t("h3",{attrs:{id:"创建一个resizeobserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建一个resizeobserver"}},[s._v("#")]),s._v(" 创建一个"),t("code",[s._v("ResizeObserver")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ro "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResizeObserver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 看一下返回的东西")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("observe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("img",{attrs:{src:"/images/frontend/js/resize-observer-02.png",alt:"resize-observer-02"}})]),s._v(" "),t("p",[s._v("返回的是一个"),t("strong",[s._v("数组")]),s._v("，它里面最重要的就两个属性："),t("code",[s._v("contentRect")]),s._v("和"),t("code",[s._v("target")]),s._v("，"),t("code",[s._v("target")]),s._v("就不说了，就是"),t("strong",[s._v("当前监听的DOM节点")]),s._v("。"),t("code",[s._v("contentRect")]),s._v("则包含了这个DOM节点的参数,包括"),t("code",[s._v("width、height、bottom、left、right、top、x和y")]),s._v("，这些应该足够使用了。")]),s._v(" "),t("h3",{attrs:{id:"取消-暂时结束观察"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#取消-暂时结束观察"}},[s._v("#")]),s._v(" 取消/暂时结束观察")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("ro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("disconnct")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("一般写在监听DOM节点被隐藏时（可以结合业务判断），主要目的是为了在"),t("strong",[s._v("隐藏/不再显示")]),s._v("这段时间内"),t("strong",[s._v("暂时")]),s._v("取消监听，节省开销。")]),s._v(" "),t("p",[s._v("那么在重新打开/进入模块时还需要重新监听：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("observe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"终止观察"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#终止观察"}},[s._v("#")]),s._v(" 终止观察")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("ro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unobserve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("模块销毁时彻底结束观察。")]),s._v(" "),t("h2",{attrs:{id:"二、需要注意的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、需要注意的"}},[s._v("#")]),s._v(" 二、需要注意的")]),s._v(" "),t("p",[t("a",{attrs:{href:"#%E4%B8%89%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[s._v("参考资料[1]")]),s._v("中说了：")]),s._v(" "),t("blockquote",[t("p",[s._v("...在使用ResizeObserver API的时候，在每次触发元素的大小变化时，会在1s内触发回调蛮多次的。如果想进一步优化性能，可以加上throttle节流函数处理...")])]),s._v(" "),t("p",[s._v("这里节流的话，在业务中实际使用会发现"),t("strong",[s._v("效果并不会流畅，就是会是一顿一顿的")]),s._v("。")]),s._v(" "),t("p",[s._v("因为"),t("strong",[s._v("节流实际上把多个事件只取一个进行处理（并不是合并，也不会合并）")]),s._v("，比如监听返回了"),t("code",[s._v("30")]),s._v("个事件，但却回调只执行了"),t("code",[s._v("6")]),s._v("次。")]),s._v(" "),t("p",[s._v("虽然是节省了开销，防止连续触发回调事件，但是如果回调的方法是执行动画效果的话，就不会很连贯，这样的话可能还需要配合"),t("code",[s._v("transition")]),s._v("这个CSS样式才行。")]),s._v(" "),t("h2",{attrs:{id:"三、参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、参考资料"}},[s._v("#")]),s._v(" 三、参考资料")]),s._v(" "),t("ul",[t("li",[s._v("1."),t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/41418813",target:"_blank",rel:"noopener noreferrer"}},[s._v("ResizeObserver API - 知乎"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("2."),t("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver",target:"_blank",rel:"noopener noreferrer"}},[s._v("ResizeObserver - Web API 接口参考 | MDN"),t("OutboundLink")],1)])])],1)}),[],!1,null,null,null);t.default=r.exports}}]);